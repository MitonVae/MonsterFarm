<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€ªå…½å†œåœº - æŒ‚æœºç»è¥æ¸¸æˆ</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/layout.css">
    <style>
        /* ===== CSS å˜é‡é©±åŠ¨ä¸‰æ å¸ƒå±€ï¼ˆç”± resizer.js åŠ¨æ€æ›´æ–°å˜é‡å€¼ï¼‰===== */
        :root {
            --left-width: 260px;
            --right-width: 280px;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* æ¡Œé¢ç«¯ä¸‰æ ç”± resizer.js ç”¨ Grid æ§åˆ¶ï¼Œæ­¤å¤„åªä¿ç•™åŸºç¡€æ ·å¼ */
        .sidebar {
            background: #21262d;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
        }

        .monster-sidebar {
            background: #161b22;
            border-left: none;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: hidden;
        }

        .main-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow: hidden auto;
        }

        .mobile-bottom-nav {
            display: none;
        }

        /* å¹³æ¿ç«¯ï¼šå·¦æ éšè—å¯åˆ‡æ¢ï¼Œå³æ æ”¶èµ· */
        @media (max-width: 1023px) and (min-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .monster-sidebar {
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }
            .monster-sidebar.open {
                transform: translateX(0);
            }
            .main-container {
                margin-left: 0;
                margin-right: 0;
            }
        }

        /* æ‰‹æœºç«¯ï¼šä¸¤ä¾§è¾¹æ éƒ½éšè—ï¼Œæ˜¾ç¤ºåº•éƒ¨å¯¼èˆª */
        @media (max-width: 767px) {
            .sidebar {
                display: none;
            }
            .monster-sidebar {
                display: none;
            }
            .main-container {
                margin-left: 0;
                margin-right: 0;
                margin-bottom: 80px;
            }
            .desktop-tabs {
                display: none;
            }
            .mobile-bottom-nav {
                display: flex !important;
            }
        }
    </style>
</head>
<body>
    <!-- åº”ç”¨å®¹å™¨ -->
    <div class="app-container">
        <!-- å·¦ä¾§æ ï¼šèµ„æº + å¿«æ·æ“ä½œ -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Monster Farm</h2>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12h18M3 6h18M3 18h18"></path>
                    </svg>
                </button>
            </div>
            
            <!-- èµ„æºé¢æ¿ -->
            <div class="sidebar-section">
                <h3>èµ„æºçŠ¶å†µ</h3>
                <div class="sidebar-resources">
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="coinsIcon"></span>
                        <span class="resource-value" id="coins">100</span>
                    </div>
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="foodIcon"></span>
                        <span class="resource-value" id="food">50</span>
                    </div>
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="materialsIcon"></span>
                        <span class="resource-value" id="materials">0</span>
                    </div>
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="researchIcon"></span>
                        <span class="resource-value" id="research">0</span>
                    </div>
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="energyIcon"></span>
                        <span class="resource-value" id="energy">100</span>
                    </div>
                </div>
            </div>
            
            <!-- å¿«æ·æ“ä½œ -->
            <div class="sidebar-section">
                <h3>å¿«æ·æ“ä½œ</h3>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="quickSave()">
                        <span class="quick-action-icon" id="quickSaveIcon"></span>
                        æ‰‹åŠ¨å­˜æ¡£
                    </button>
                    <button class="quick-action-btn" onclick="recallAllMonsters()">
                        <span class="quick-action-icon" id="recallIcon"></span>
                        å¬å›æ€ªå…½
                    </button>
                </div>
            </div>

            <!-- å†œåœºçŠ¶æ€æ‘˜è¦ -->
            <div class="sidebar-section" id="farmSummarySection">
                <h3>å†œåœºæ¦‚å†µ</h3>
                <div id="farmSummary" style="font-size:12px;color:#8b949e;line-height:1.8;">
                    <!-- ç”±JSåŠ¨æ€å¡«å…… -->
                </div>
            </div>

            <!-- å®æ—¶ç®€æŠ¥ -->
            <div class="sidebar-section" id="briefingSection" style="flex:1;display:flex;flex-direction:column;min-height:0;">
                <h3 style="display:flex;align-items:center;justify-content:space-between;flex-shrink:0;">
                    <span>ğŸ“‹ å®æ—¶ç®€æŠ¥</span>
                    <span id="briefingBadge" style="display:none;background:#f85149;color:#fff;font-size:10px;
                          padding:1px 6px;border-radius:8px;font-weight:700;">NEW</span>
                </h3>
                <div id="briefingList" style="flex:1;overflow-y:auto;min-height:120px;max-height:260px;">
                    <div class="briefing-empty">æš‚æ— åŠ¨æ€ï¼Œå¼€å§‹æ¸¸æˆå§ï¼</div>
                </div>
            </div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-container">
            <!-- æ¡Œé¢ç«¯æ ‡ç­¾å¯¼èˆªï¼ˆå·²ç§»é™¤æ€ªå…½æ ‡ç­¾ï¼‰ -->
            <div class="desktop-tabs">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('farm')">ğŸŒ¾ å†œåœº</div>
                    <div class="tab" onclick="switchTab('exploration')">ğŸ—º æ¢ç´¢</div>
                    <div class="tab" onclick="switchTab('breeding')">ğŸ’• ç¹æ®–</div>
                    <div class="tab" onclick="switchTab('tech')">ğŸ”¬ ç§‘æŠ€</div>
                    <div class="tab" onclick="switchTab('disposal')">â™» å¤„ç†</div>
                </div>
            </div>

            <!-- ä¸»å†…å®¹åŒº -->
            <div class="main-content">
                <div id="farm-tab" class="tab-content active">
                    <div class="farm-container">
                        <h2>ğŸŒ¾ è€•ä½œåŒº</h2>
                        <div class="farm-grid" id="farmGrid"></div>
                    </div>
                </div>
                
                <div id="exploration-tab" class="tab-content">
                    <div class="exploration-area" id="explorationArea"></div>
                </div>
                
                <div id="breeding-tab" class="tab-content">
                    <div class="breeding-container" id="breedingContainer"></div>
                </div>
                
                <div id="tech-tab" class="tab-content">
                    <div class="farm-container">
                        <h2>ğŸ”¬ ç§‘æŠ€æ ‘</h2>
                        <div class="tech-tree" id="techTree"></div>
                    </div>
                </div>
                
                <div id="disposal-tab" class="tab-content">
                    <div class="disposal-container" id="disposalContainer"></div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§æ ï¼šæ€ªå…½ç®¡ç†é¢æ¿ -->
        <div class="monster-sidebar" id="monsterSidebar">
            <div class="monster-sidebar-header">
                <span>ğŸ‘¾ æ€ªå…½å›¢é˜Ÿ</span>
                <button class="monster-sidebar-toggle" id="monsterSidebarToggle" onclick="toggleMonsterSidebar()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <!-- æ¢ç´¢å…¥å£ -->
            <div class="monster-sidebar-recruit">
                <button class="btn btn-explore" style="width:100%;font-size:13px;padding:8px 12px;" onclick="switchTab('exploration')">
                    ğŸ—º å‰å¾€æ¢ç´¢æ•è·æ€ªå…½
                </button>
            </div>
            <!-- æ€ªå…½åˆ—è¡¨ -->
            <div class="monster-sidebar-list" id="monsterSidebarList">
                <!-- ç”±JSåŠ¨æ€å¡«å…… -->
            </div>
            <!-- åº•éƒ¨ç»Ÿè®¡ -->
            <div class="monster-sidebar-footer" id="monsterSidebarFooter">
                <!-- ç”±JSåŠ¨æ€å¡«å…… -->
            </div>
        </div>
        
        <!-- ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªæ ï¼ˆå«æ€ªå…½å…¥å£ï¼‰ -->
        <div class="mobile-bottom-nav">
            <div class="bottom-nav-item active" onclick="switchTab('farm')" data-tab="farm">
                <span class="nav-icon" id="farmNavIcon"></span>
                <span class="nav-label">å†œåœº</span>
            </div>
            <div class="bottom-nav-item" onclick="showMobileMonsterPanel()" data-tab="monsters">
                <span class="nav-icon" id="monstersNavIcon"></span>
                <span class="nav-label">æ€ªå…½</span>
            </div>
            <div class="bottom-nav-item" onclick="switchTab('exploration')" data-tab="exploration">
                <span class="nav-icon" id="explorationNavIcon"></span>
                <span class="nav-label">æ¢ç´¢</span>
            </div>
            <div class="bottom-nav-item" onclick="switchTab('breeding')" data-tab="breeding">
                <span class="nav-icon" id="breedingNavIcon"></span>
                <span class="nav-label">ç¹æ®–</span>
            </div>
            <div class="bottom-nav-item" onclick="switchTab('tech')" data-tab="tech">
                <span class="nav-icon" id="techNavIcon"></span>
                <span class="nav-label">ç§‘æŠ€</span>
            </div>
            <div class="bottom-nav-item" onclick="switchTab('disposal')" data-tab="disposal">
                <span class="nav-icon" id="disposalNavIcon"></span>
                <span class="nav-label">å¤„ç†</span>
            </div>
        </div>
    </div>
    
    <!-- æ¨¡æ€æ¡† -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent"></div>
    </div>

    <!-- æŒ‰é¡ºåºåŠ è½½JSæ¨¡å— -->
    <script src="js/briefing.js"></script>
    <script src="js/main.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/farm.js"></script>
    <script src="js/monster.js"></script>
    <script src="js/exploration.js"></script>
    <script src="js/breeding.js"></script>
    <script src="js/tech.js"></script>
    <script src="js/disposal.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/resizer.js"></script>
    <script src="js/tutorial.js"></script>
    <script>
        // é¡µé¢åŠ è½½ååˆå§‹åŒ–
        window.addEventListener('load', function() {
            loadGame();   // å°è¯•åŠ è½½å­˜æ¡£
            initGame();   // åˆå§‹åŒ–æ¸¸æˆ
            
            // å¼ºåˆ¶åˆå§‹åŒ–UIç»„ä»¶
            setTimeout(function() {
                updateResources();
                renderAll();
                
                // ç¡®ä¿ä¾§è¾¹æ å›¾æ ‡æ˜¾ç¤º
                updateSidebarResources();
                initMobileNavIcons();
            }, 100);
        });
        
        // å›¾æ ‡åå¤‡åˆå§‹åŒ–ï¼ˆä»…å¤„ç†å›¾æ ‡ï¼Œä¸å¹²é¢„å¸ƒå±€ï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                function createSimpleSVG(type, size) {
                    var svgMap = {
                        coin:     '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#f0c53d"/></svg>',
                        food:     '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#46d164"/></svg>',
                        material: '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12" fill="#8b949e"/></svg>',
                        research: '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><polygon points="12,2 22,20 2,20" fill="#58a6ff"/></svg>',
                        energy:   '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#2ea043"/></svg>'
                    };
                    return svgMap[type] || '';
                }
                var icons = { coinsIcon:'coin', foodIcon:'food', materialsIcon:'material', researchIcon:'research', energyIcon:'energy' };
                for (var id in icons) {
                    var el = document.getElementById(id);
                    if (el && !el.innerHTML.trim()) {
                        el.innerHTML = (typeof createSVG === 'function' ? createSVG(icons[id], 20) : createSimpleSVG(icons[id], 20));
                    }
                }
            }, 300);
        });
    </script>
</body>
</html>