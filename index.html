<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€ªå…½å†œåœº - æŒ‚æœºç»è¥æ¸¸æˆ</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/layout.css">
</head>
<body>
    <!-- åº”ç”¨å®¹å™¨ -->
    <div class="app-container" id="appContainer">

        <!-- å·¦ä¾§æ ï¼šèµ„æº + å¿«æ·æ“ä½œï¼ˆPC å›ºå®šæ˜¾ç¤ºï¼Œç§»åŠ¨ç«¯éšè—ï¼‰-->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Monster Farm</h2>
            </div>
            
            <!-- èµ„æºé¢æ¿ -->
            <div class="sidebar-section">
                <h3>èµ„æºçŠ¶å†µ</h3>
                <div class="sidebar-resources">
                    <div class="sidebar-resource res-clickable" data-res="coins" onclick="toggleResourceDetail('coins')">
                        <span class="resource-icon" id="coinsIcon"></span>
                        <span class="resource-label">é‡‘å¸</span>
                        <span class="resource-value" id="coins">100</span>
                        <span class="res-chevron" id="chevron-coins">â–¾</span>
                    </div>
                    <div class="res-detail" id="detail-coins"></div>

                    <div class="sidebar-resource res-clickable" data-res="food" onclick="toggleResourceDetail('food')">
                        <span class="resource-icon" id="foodIcon"></span>
                        <span class="resource-label">é£Ÿç‰©</span>
                        <span class="resource-value" id="food">50</span>
                        <span class="res-chevron" id="chevron-food">â–¾</span>
                    </div>
                    <div class="res-detail" id="detail-food"></div>

                    <div class="sidebar-resource res-clickable" data-res="materials" onclick="toggleResourceDetail('materials')">
                        <span class="resource-icon" id="materialsIcon"></span>
                        <span class="resource-label">ææ–™</span>
                        <span class="resource-value" id="materials">0</span>
                        <span class="res-chevron" id="chevron-materials">â–¾</span>
                    </div>
                    <div class="res-detail" id="detail-materials"></div>

                    <div class="sidebar-resource res-clickable" data-res="research" onclick="toggleResourceDetail('research')">
                        <span class="resource-icon" id="researchIcon"></span>
                        <span class="resource-label">ç ”ç©¶</span>
                        <span class="resource-value" id="research">0</span>
                        <span class="res-chevron" id="chevron-research">â–¾</span>
                    </div>
                    <div class="res-detail" id="detail-research"></div>

                    <div class="sidebar-resource res-clickable" data-res="energy" onclick="toggleResourceDetail('energy')">
                        <span class="resource-icon" id="energyIcon"></span>
                        <span class="resource-label">èƒ½é‡</span>
                        <span class="resource-value" id="energy">100</span>
                        <span class="res-chevron" id="chevron-energy">â–¾</span>
                    </div>
                    <div class="res-detail" id="detail-energy"></div>
                </div>
            </div>
            
            <!-- å¿«æ·æ“ä½œ -->
            <div class="sidebar-section">
                <h3>å¿«æ·æ“ä½œ</h3>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="quickSave()">
                        <span class="quick-action-icon" id="quickSaveIcon"></span>
                        æ‰‹åŠ¨å­˜æ¡£
                    </button>
                    <button class="quick-action-btn" onclick="confirmRecallAll()">
                        <span class="quick-action-icon" id="recallIcon"></span>
                        å¬å›æ€ªå…½
                    </button>
                    <button class="quick-action-btn" onclick="showSettingsModal()">
                        <span class="quick-action-icon" id="settingsIcon"></span>
                        è®¾ç½®
                    </button>
                </div>
            </div>

            <!-- å†œåœºçŠ¶æ€æ‘˜è¦ -->
            <div class="sidebar-section" id="farmSummarySection">
                <h3>å†œåœºæ¦‚å†µ</h3>
                <div id="farmSummary" style="font-size:12px;color:#8b949e;line-height:1.8;"></div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-container" id="mainContainer">

            <!-- ç§»åŠ¨ç«¯é¡¶éƒ¨èµ„æºçŠ¶æ€æ¡ï¼ˆä»…ç§»åŠ¨ç«¯å¯è§ï¼‰-->
            <div class="mobile-topbar" id="mobileTopbar">
                <!-- ç¬¬ä¸€è¡Œï¼šæ ‡é¢˜ + å¾½ç«  + æ“ä½œæŒ‰é’® -->
                <div class="mobile-topbar-row1">
                    <div class="mobile-topbar-title">âš” Monster Farm</div>
                    <div style="display:flex;align-items:center;gap:4px;flex:1;justify-content:flex-end;">
                        <span class="mob-stat-badge" id="mobMonsterBadge"><span class="val" id="mob-monster-count">0</span> æ€ª</span>
                        <span class="mob-stat-badge" id="mobFarmBadge"><span class="val" id="mob-farm-status">å†œåœº</span></span>
                        <div class="mob-topbar-actions">
                            <button class="mob-settings-btn" onclick="showMobileResourcePanel()" title="èµ„æºè¯¦æƒ…">ğŸ“Š</button>
                            <button class="mob-settings-btn" onclick="showSettingsModal()" title="è®¾ç½®">âš™</button>
                        </div>
                    </div>
                </div>
                <!-- ç¬¬äºŒè¡Œï¼šèµ„æºçŠ¶æ€ 4æ ¼ç½‘æ ¼ -->
                <div class="mobile-topbar-resources">
                    <div class="mob-res" onclick="showMobileResourcePanel()">
                        <span class="mob-res-icon" id="mobCoinsIcon"></span>
                        <span class="mob-res-val" id="mob-coins">100</span>
                        <span class="mob-res-rate" id="mob-coins-rate"></span>
                    </div>
                    <div class="mob-res" onclick="showMobileResourcePanel()">
                        <span class="mob-res-icon" id="mobFoodIcon"></span>
                        <span class="mob-res-val" id="mob-food">50</span>
                        <span class="mob-res-rate" id="mob-food-rate"></span>
                    </div>
                    <div class="mob-res" onclick="showMobileResourcePanel()">
                        <span class="mob-res-icon" id="mobMaterialsIcon"></span>
                        <span class="mob-res-val" id="mob-materials">0</span>
                        <span class="mob-res-rate" id="mob-materials-rate"></span>
                    </div>
                    <div class="mob-res" onclick="showMobileResourcePanel()">
                        <span class="mob-res-icon" id="mobEnergyIcon"></span>
                        <span class="mob-res-val" id="mob-energy">100</span>
                        <span class="mob-res-rate" id="mob-energy-rate"></span>
                    </div>
                </div>
            </div>

            <!-- PC ç«¯æ ‡ç­¾å¯¼èˆª -->
            <div class="desktop-tabs">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('farm')"><span class="nav-icon" id="farmTabIcon"></span> å†œåœº</div>
                    <div class="tab" onclick="switchTab('exploration')"><span class="nav-icon" id="explorationTabIcon"></span> æ¢ç´¢</div>
                    <div class="tab" onclick="switchTab('breeding')"><span class="nav-icon" id="breedingTabIcon"></span> ç¹æ®–</div>
                    <div class="tab" onclick="switchTab('tech')"><span class="nav-icon" id="techTabIcon"></span> ç§‘æŠ€</div>
                    <div class="tab" onclick="switchTab('disposal')"><span class="nav-icon" id="disposalTabIcon"></span> å¤„ç†</div>
                </div>
            </div>

            <!-- ä¸»å†…å®¹åŒº -->
            <div class="main-content">
                <div id="farm-tab" class="tab-content active">
                    <div class="farm-container">
                        <h2>ğŸŒ¾ è€•ä½œåŒº</h2>
                        <div class="farm-grid" id="farmGrid"></div>
                    </div>
                </div>
                <div id="exploration-tab" class="tab-content">
                    <div class="exploration-area" id="explorationArea"></div>
                </div>
                <div id="breeding-tab" class="tab-content">
                    <div class="breeding-container" id="breedingContainer"></div>
                </div>
                <div id="tech-tab" class="tab-content">
                    <div class="farm-container">
                        <h2>ğŸ”¬ ç§‘æŠ€æ ‘</h2>
                        <div class="tech-tree" id="techTree"></div>
                    </div>
                </div>
                <div id="disposal-tab" class="tab-content">
                    <div class="disposal-container" id="disposalContainer"></div>
                </div>

                <!-- ç§»åŠ¨ç«¯æ€ªå…½å›¢é˜Ÿ tabï¼ˆä»…ç§»åŠ¨ç«¯æ˜¾ç¤ºï¼Œå†…å®¹ä¸ PC å³ä¾§æ ä¸€è‡´ï¼‰-->
                <div id="monsters-tab" class="tab-content">
                    <div style="padding:0;">
                        <div style="padding:12px 14px;border-bottom:1px solid #30363d;">
                            <button class="btn btn-explore" style="width:100%;font-size:13px;padding:8px 12px;" onclick="switchTab('exploration')">
                                ğŸ—º å‰å¾€æ¢ç´¢æ•è·æ€ªå…½
                            </button>
                        </div>
                        <div id="mobileMonsterList" style="padding:10px;"></div>
                        <div id="mobileMonsterFooter" style="padding:12px 14px;border-top:1px solid #30363d;font-size:13px;color:#8b949e;background:#0d1117;"></div>
                    </div>
                </div>
            </div>

            <!-- å‚ç›´æ‹–æ‹½æ‰‹æŸ„ï¼šåˆ†éš”ä¸»å†…å®¹åŒºä¸ç®€æŠ¥é¢æ¿ -->
            <div class="briefing-v-resizer" id="briefingVResizer" title="æ‹–æ‹½è°ƒæ•´ç®€æŠ¥é¢æ¿é«˜åº¦"></div>

            <!-- åº•éƒ¨å®æ—¶ç®€æŠ¥é¢æ¿ -->
            <div class="briefing-panel" id="briefingSection">
                <div class="briefing-panel-header">
                    <span>ğŸ“‹ å®æ—¶ç®€æŠ¥</span>
                    <span id="briefingBadge" style="display:none;background:#f85149;color:#fff;font-size:10px;padding:1px 6px;border-radius:8px;font-weight:700;margin-left:8px;">NEW</span>
                    <span class="briefing-panel-toggle" id="briefingToggleBtn" onclick="toggleBriefingPanel()" title="æŠ˜å /å±•å¼€ç®€æŠ¥">â–¾</span>
                </div>
                <div id="briefingList" class="briefing-panel-list">
                    <div class="briefing-empty">æš‚æ— åŠ¨æ€ï¼Œå¼€å§‹æ¸¸æˆå§ï¼</div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§æ ï¼šæ€ªå…½ç®¡ç†é¢æ¿ï¼ˆPC å›ºå®šæ˜¾ç¤ºï¼‰-->
        <div class="monster-sidebar" id="monsterSidebar">
            <div class="monster-sidebar-header">
                <span>ğŸ‘¾ æ€ªå…½å›¢é˜Ÿ</span>
            </div>
            <div class="monster-sidebar-recruit">
                <button class="btn btn-explore" style="width:100%;font-size:13px;padding:8px 12px;" onclick="switchTab('exploration')">
                    ğŸ—º å‰å¾€æ¢ç´¢æ•è·æ€ªå…½
                </button>
            </div>
            <div class="monster-sidebar-list" id="monsterSidebarList"></div>
            <div class="monster-sidebar-footer" id="monsterSidebarFooter"></div>
        </div>
    </div>
    
    <!-- æ¨¡æ€æ¡† -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent"></div>
    </div>

    <!-- ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªæ  -->
    <nav class="mobile-bottom-nav" id="mobileBottomNav">
        <div class="bottom-nav-item active" onclick="switchTab('farm')" data-tab="farm">
            <span class="nav-icon" id="farmNavIcon"></span>
            <span class="nav-label">å†œåœº</span>
        </div>
        <div class="bottom-nav-item" onclick="switchTab('exploration')" data-tab="exploration">
            <span class="nav-icon" id="explorationNavIcon"></span>
            <span class="nav-label">æ¢ç´¢</span>
        </div>
        <div class="bottom-nav-item" onclick="switchTab('monsters')" data-tab="monsters">
            <span class="nav-icon" id="monstersNavIcon"></span>
            <span class="nav-label">æ€ªå…½</span>
        </div>
        <div class="bottom-nav-item" onclick="switchTab('breeding')" data-tab="breeding">
            <span class="nav-icon" id="breedingNavIcon"></span>
            <span class="nav-label">ç¹æ®–</span>
        </div>
        <div class="bottom-nav-item" onclick="switchTab('tech')" data-tab="tech">
            <span class="nav-icon" id="techNavIcon"></span>
            <span class="nav-label">ç§‘æŠ€</span>
        </div>
        <div class="bottom-nav-item" onclick="switchTab('disposal')" data-tab="disposal">
            <span class="nav-icon" id="disposalNavIcon"></span>
            <span class="nav-label">å¤„ç†</span>
        </div>
    </nav>

    <!-- Supabase JS SDK (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

    <!-- æŒ‰é¡ºåºåŠ è½½JSæ¨¡å— -->
    <script src="js/auth.js"></script>
    <script src="js/briefing.js"></script>
    <script src="js/resource-detail.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/gamedata.js"></script>
    <script src="js/main.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/farm.js"></script>
    <script src="js/monster.js"></script>
    <script src="js/exploration.js"></script>
    <script src="js/breeding.js"></script>
    <script src="js/tech.js"></script>
    <script src="js/disposal.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/resizer.js"></script>
    <script src="js/tutorial.js"></script>
    <script src="js/gm.js"></script>
    <script>
        window.addEventListener('load', function() {
            // åˆå§‹åŒ– Supabaseï¼ˆéœ€åœ¨ loadGame ä¹‹å‰ï¼Œä»¥ä¾¿ä¼šè¯æ¢å¤åè§¦å‘ onAuthStateChangeï¼‰
            if (typeof initSupabase === 'function') initSupabase();
            loadGame();
            initGame();
            setTimeout(function() {
                updateResources();
                renderAll();
                updateSidebarResources();
                initMobileNavIcons();
                applyFontSize(localStorage.getItem('mf_font_size') || 'medium');
            }, 100);
        });
    </script>
</body>
</html>