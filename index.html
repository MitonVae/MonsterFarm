<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>怪兽农场 - 挂机经营游戏</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/layout.css">
    <style>
        /* 确保布局正确显示的覆盖样式 */
        .app-container {
            display: flex !important;
            min-height: 100vh !important;
        }
        
        .sidebar {
            width: 300px !important;
            background: #21262d !important;
            position: fixed !important;
            left: 0 !important;
            top: 0 !important;
            height: 100vh !important;
            z-index: 100 !important;
        }
        
        .main-container {
            flex: 1 !important;
            margin-left: 300px !important;
            display: flex !important;
            flex-direction: column !important;
        }
        
        .mobile-bottom-nav {
            display: none !important;
        }
        
        /* 桌面端显示侧边栏 */
        @media (min-width: 1024px) {
            .sidebar {
                display: flex !important;
            }
        }
        
        /* 平板端隐藏侧边栏，但可切换 */
        @media (max-width: 1023px) and (min-width: 768px) {
            .sidebar {
                transform: translateX(-100%) !important;
            }
            
            .sidebar.open {
                transform: translateX(0) !important;
            }
            
            .main-container {
                margin-left: 0 !important;
            }
        }
        
        /* 手机端隐藏侧边栏，显示底部导航 */
        @media (max-width: 767px) {
            .sidebar {
                display: none !important;
            }
            
            .main-container {
                margin-left: 0 !important;
                margin-bottom: 80px !important;
            }
            
            .desktop-tabs {
                display: none !important;
            }
            
            .mobile-bottom-nav {
                display: flex !important;
            }
        }
    </style>
</head>
<body>
    <!-- 应用容器 -->
    <div class="app-container">
        <!-- 左侧栏 (桌面端和平板端) -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Monster Farm</h2>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12h18M3 6h18M3 18h18"></path>
                    </svg>
                </button>
            </div>
            
            <!-- 资源面板 -->
            <div class="sidebar-section">
                <h3>资源状况</h3>
                <div class="sidebar-resources">
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="coinsIcon"></span>
                        <span class="resource-value" id="coins">100</span>
                    </div>
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="foodIcon"></span>
                        <span class="resource-value" id="food">50</span>
                    </div>
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="materialsIcon"></span>
                        <span class="resource-value" id="materials">0</span>
                    </div>
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="researchIcon"></span>
                        <span class="resource-value" id="research">0</span>
                    </div>
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="energyIcon"></span>
                        <span class="resource-value" id="energy">100</span>
                    </div>
                </div>
            </div>
            
            <!-- 怪兽列表 -->
            <div class="sidebar-section">
                <h3>怪兽团队</h3>
                <div class="sidebar-monsters" id="sidebarMonsters">
                    <!-- 怪兽列表将通过JS动态生成 -->
                </div>
            </div>
            
            <!-- 快捷操作 -->
            <div class="sidebar-section">
                <h3>快捷操作</h3>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="autoHarvestAll()">
                        <span class="quick-action-icon"></span>
                        一键收获
                    </button>
                    <button class="quick-action-btn" onclick="autoPlantAll()">
                        <span class="quick-action-icon"></span>
                        自动种植
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 主内容区域 -->
        <div class="main-container">
            <!-- 桌面端标签导航 -->
            <div class="desktop-tabs">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('farm')">农场</div>
                    <div class="tab" onclick="switchTab('monsters')">怪兽</div>
                    <div class="tab" onclick="switchTab('exploration')">探索</div>
                    <div class="tab" onclick="switchTab('breeding')">繁殖</div>
                    <div class="tab" onclick="switchTab('tech')">科技</div>
                    <div class="tab" onclick="switchTab('disposal')">处理</div>
                </div>
            </div>

            <!-- 主内容区 -->
            <div class="main-content">
                <div id="farm-tab" class="tab-content active">
                    <div class="farm-container">
                        <h2>农场管理</h2>
                        <div class="farm-grid" id="farmGrid"></div>
                    </div>
                </div>
                
                <div id="monsters-tab" class="tab-content">
                    <div class="farm-container">
                        <h2>怪兽管理 <span style="font-size: 14px; color: #666;">(点击选择怪兽进行分配)</span></h2>
                        <div style="margin: 15px 0;">
                            <button class="btn btn-primary" onclick="showRecruitModal()">招募怪兽</button>
                        </div>
                        <div class="monster-grid" id="monsterGrid"></div>
                    </div>
                </div>
                
                <div id="exploration-tab" class="tab-content">
                    <div class="exploration-area" id="explorationArea"></div>
                </div>
                
                <div id="breeding-tab" class="tab-content">
                    <div class="breeding-container" id="breedingContainer"></div>
                </div>
                
                <div id="tech-tab" class="tab-content">
                    <div class="farm-container">
                        <h2>科技树</h2>
                        <div class="tech-tree" id="techTree"></div>
                    </div>
                </div>
                
                <div id="disposal-tab" class="tab-content">
                    <div class="disposal-container" id="disposalContainer"></div>
                </div>
            </div>
        </div>
        
        <!-- 移动端底部导航栏 -->
        <div class="mobile-bottom-nav">
            <div class="bottom-nav-item active" onclick="switchTab('farm')" data-tab="farm">
                <span class="nav-icon" id="farmNavIcon"></span>
                <span class="nav-label">农场</span>
            </div>
            <div class="bottom-nav-item" onclick="switchTab('monsters')" data-tab="monsters">
                <span class="nav-icon" id="monstersNavIcon"></span>
                <span class="nav-label">怪兽</span>
            </div>
            <div class="bottom-nav-item" onclick="switchTab('exploration')" data-tab="exploration">
                <span class="nav-icon" id="explorationNavIcon"></span>
                <span class="nav-label">探索</span>
            </div>
            <div class="bottom-nav-item" onclick="switchTab('breeding')" data-tab="breeding">
                <span class="nav-icon" id="breedingNavIcon"></span>
                <span class="nav-label">繁殖</span>
            </div>
            <div class="bottom-nav-item" onclick="switchTab('tech')" data-tab="tech">
                <span class="nav-icon" id="techNavIcon"></span>
                <span class="nav-label">科技</span>
            </div>
            <div class="bottom-nav-item" onclick="switchTab('disposal')" data-tab="disposal">
                <span class="nav-icon" id="disposalNavIcon"></span>
                <span class="nav-label">处理</span>
            </div>
        </div>
    </div>
    
    <!-- 模态框 -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent"></div>
    </div>

    <!-- 按顺序加载JS模块 -->
    <script src="js/main.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/farm.js"></script>
    <script src="js/monster.js"></script>
    <script src="js/exploration.js"></script>
    <script src="js/breeding.js"></script>
    <script src="js/tech.js"></script>
    <script src="js/disposal.js"></script>
    <script src="js/ui.js"></script>
    <script>
        // 页面加载后初始化
        window.addEventListener('load', function() {
            loadGame();   // 尝试加载存档
            initGame();   // 初始化游戏
            
            // 强制初始化UI组件
            setTimeout(function() {
                updateResources();
                renderAll();
                
                // 确保侧边栏图标显示
                updateSidebarResources();
                initMobileNavIcons();
            }, 100);
        });
        
        // DOMContentLoaded 备用初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded triggered');
            
            // 强制显示应用容器
            var appContainer = document.querySelector('.app-container');
            if (appContainer) {
                appContainer.style.display = 'flex';
                appContainer.style.minHeight = '100vh';
                console.log('App container forced to display');
            }
            
            // 强制显示侧边栏
            var sidebar = document.getElementById('sidebar');
            if (sidebar) {
                sidebar.style.display = 'flex';
                sidebar.style.flexDirection = 'column';
                console.log('Sidebar forced to display');
            }
            
            // 强制显示主容器
            var mainContainer = document.querySelector('.main-container');
            if (mainContainer) {
                mainContainer.style.display = 'flex';
                mainContainer.style.flexDirection = 'column';
                mainContainer.style.marginLeft = '300px';
                console.log('Main container forced to display');
            }
            
            // 如果元素存在但没有内容，强制设置
            setTimeout(function() {
                var coinsIcon = document.getElementById('coinsIcon');
                var foodIcon = document.getElementById('foodIcon');
                var materialsIcon = document.getElementById('materialsIcon');
                var researchIcon = document.getElementById('researchIcon');
                var energyIcon = document.getElementById('energyIcon');
                
                // 简单的SVG创建函数作为后备
                function createSimpleSVG(type, size) {
                    var svgMap = {
                        coin: '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#f0c53d"/></svg>',
                        food: '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#46d164"/></svg>',
                        material: '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12" fill="#8b949e"/></svg>',
                        research: '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><polygon points="12,2 22,20 2,20" fill="#58a6ff"/></svg>',
                        energy: '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#2ea043"/></svg>'
                    };
                    return svgMap[type] || '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#666"/></svg>';
                }
                
                if (coinsIcon) {
                    coinsIcon.innerHTML = (typeof createSVG === 'function' ? createSVG('coin', 20) : createSimpleSVG('coin', 20));
                    console.log('Coins icon set');
                }
                if (foodIcon) {
                    foodIcon.innerHTML = (typeof createSVG === 'function' ? createSVG('food', 20) : createSimpleSVG('food', 20));
                    console.log('Food icon set');
                }
                if (materialsIcon) {
                    materialsIcon.innerHTML = (typeof createSVG === 'function' ? createSVG('material', 20) : createSimpleSVG('material', 20));
                    console.log('Materials icon set');
                }
                if (researchIcon) {
                    researchIcon.innerHTML = (typeof createSVG === 'function' ? createSVG('research', 20) : createSimpleSVG('research', 20));
                    console.log('Research icon set');
                }
                if (energyIcon) {
                    energyIcon.innerHTML = (typeof createSVG === 'function' ? createSVG('energy', 20) : createSimpleSVG('energy', 20));
                    console.log('Energy icon set');
                }
                
                // 检查并显示调试信息
                console.log('Layout fix applied. If you still see issues, check browser console for errors.');
            }, 200);
        });
    </script>
</body>
</html>