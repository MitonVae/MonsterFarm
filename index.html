<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€ªå…½å†œåœº - æŒ‚æœºç»è¥æ¸¸æˆ</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/layout.css">
    <style>
        /* ===== CSS å˜é‡é©±åŠ¨ä¸‰æ å¸ƒå±€ï¼ˆç”± resizer.js åŠ¨æ€æ›´æ–°å˜é‡å€¼ï¼‰===== */
        :root {
            --left-width: 260px;
            --right-width: 280px;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: var(--left-width);
            background: #21262d;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            z-index: 100;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .monster-sidebar {
            width: var(--right-width);
            background: #161b22;
            border-left: 1px solid #30363d;
            position: fixed;
            right: 0;
            top: 0;
            height: 100vh;
            z-index: 100;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .main-container {
            flex: 1;
            margin-left: var(--left-width);
            margin-right: var(--right-width);
            display: flex;
            flex-direction: column;
        }

        .mobile-bottom-nav {
            display: none;
        }

        /* å¹³æ¿ç«¯ï¼šå·¦æ éšè—å¯åˆ‡æ¢ï¼Œå³æ æ”¶èµ· */
        @media (max-width: 1023px) and (min-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .monster-sidebar {
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }
            .monster-sidebar.open {
                transform: translateX(0);
            }
            .main-container {
                margin-left: 0;
                margin-right: 0;
            }
        }

        /* æ‰‹æœºç«¯ï¼šä¸¤ä¾§è¾¹æ éƒ½éšè—ï¼Œæ˜¾ç¤ºåº•éƒ¨å¯¼èˆª */
        @media (max-width: 767px) {
            .sidebar {
                display: none;
            }
            .monster-sidebar {
                display: none;
            }
            .main-container {
                margin-left: 0;
                margin-right: 0;
                margin-bottom: 80px;
            }
            .desktop-tabs {
                display: none;
            }
            .mobile-bottom-nav {
                display: flex !important;
            }
        }
    </style>
</head>
<body>
    <!-- åº”ç”¨å®¹å™¨ -->
    <div class="app-container">
        <!-- å·¦ä¾§æ ï¼šèµ„æº + å¿«æ·æ“ä½œ -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Monster Farm</h2>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12h18M3 6h18M3 18h18"></path>
                    </svg>
                </button>
            </div>
            
            <!-- èµ„æºé¢æ¿ -->
            <div class="sidebar-section">
                <h3>èµ„æºçŠ¶å†µ</h3>
                <div class="sidebar-resources">
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="coinsIcon"></span>
                        <span class="resource-value" id="coins">100</span>
                    </div>
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="foodIcon"></span>
                        <span class="resource-value" id="food">50</span>
                    </div>
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="materialsIcon"></span>
                        <span class="resource-value" id="materials">0</span>
                    </div>
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="researchIcon"></span>
                        <span class="resource-value" id="research">0</span>
                    </div>
                    <div class="sidebar-resource">
                        <span class="resource-icon" id="energyIcon"></span>
                        <span class="resource-value" id="energy">100</span>
                    </div>
                </div>
            </div>
            
            <!-- å¿«æ·æ“ä½œ -->
            <div class="sidebar-section">
                <h3>å¿«æ·æ“ä½œ</h3>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="autoHarvestAll()">
                        <span class="quick-action-icon"></span>
                        ä¸€é”®æ”¶è·
                    </button>
                    <button class="quick-action-btn" onclick="autoPlantAll()">
                        <span class="quick-action-icon"></span>
                        è‡ªåŠ¨ç§æ¤
                    </button>
                </div>
            </div>

            <!-- å†œåœºçŠ¶æ€æ‘˜è¦ -->
            <div class="sidebar-section" id="farmSummarySection">
                <h3>å†œåœºæ¦‚å†µ</h3>
                <div id="farmSummary" style="font-size:12px;color:#8b949e;line-height:1.8;">
                    <!-- ç”±JSåŠ¨æ€å¡«å…… -->
                </div>
            </div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-container">
            <!-- æ¡Œé¢ç«¯æ ‡ç­¾å¯¼èˆªï¼ˆå·²ç§»é™¤æ€ªå…½æ ‡ç­¾ï¼‰ -->
            <div class="desktop-tabs">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('farm')">ğŸŒ¾ å†œåœº</div>
                    <div class="tab" onclick="switchTab('exploration')">ğŸ—º æ¢ç´¢</div>
                    <div class="tab" onclick="switchTab('breeding')">ğŸ’• ç¹æ®–</div>
                    <div class="tab" onclick="switchTab('tech')">ğŸ”¬ ç§‘æŠ€</div>
                    <div class="tab" onclick="switchTab('disposal')">â™» å¤„ç†</div>
                </div>
            </div>

            <!-- ä¸»å†…å®¹åŒº -->
            <div class="main-content">
                <div id="farm-tab" class="tab-content active">
                    <div class="farm-container">
                        <h2>ğŸŒ¾ è€•ä½œåŒº</h2>
                        <div class="farm-grid" id="farmGrid"></div>
                    </div>
                </div>
                
                <div id="exploration-tab" class="tab-content">
                    <div class="exploration-area" id="explorationArea"></div>
                </div>
                
                <div id="breeding-tab" class="tab-content">
                    <div class="breeding-container" id="breedingContainer"></div>
                </div>
                
                <div id="tech-tab" class="tab-content">
                    <div class="farm-container">
                        <h2>ğŸ”¬ ç§‘æŠ€æ ‘</h2>
                        <div class="tech-tree" id="techTree"></div>
                    </div>
                </div>
                
                <div id="disposal-tab" class="tab-content">
                    <div class="disposal-container" id="disposalContainer"></div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§æ ï¼šæ€ªå…½ç®¡ç†é¢æ¿ -->
        <div class="monster-sidebar" id="monsterSidebar">
            <div class="monster-sidebar-header">
                <span>ğŸ‘¾ æ€ªå…½å›¢é˜Ÿ</span>
                <button class="monster-sidebar-toggle" id="monsterSidebarToggle" onclick="toggleMonsterSidebar()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <!-- æ‹›å‹ŸæŒ‰é’® -->
            <div class="monster-sidebar-recruit">
                <button class="btn btn-primary" style="width:100%;font-size:13px;padding:8px 12px;" onclick="showRecruitModal()">
                    + æ‹›å‹Ÿæ€ªå…½
                </button>
            </div>
            <!-- æ€ªå…½åˆ—è¡¨ -->
            <div class="monster-sidebar-list" id="monsterSidebarList">
                <!-- ç”±JSåŠ¨æ€å¡«å…… -->
            </div>
            <!-- åº•éƒ¨ç»Ÿè®¡ -->
            <div class="monster-sidebar-footer" id="monsterSidebarFooter">
                <!-- ç”±JSåŠ¨æ€å¡«å…… -->
            </div>
        </div>
        
        <!-- ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªæ ï¼ˆå«æ€ªå…½å…¥å£ï¼‰ -->
        <div class="mobile-bottom-nav">
            <div class="bottom-nav-item active" onclick="switchTab('farm')" data-tab="farm">
                <span class="nav-icon" id="farmNavIcon"></span>
                <span class="nav-label">å†œåœº</span>
            </div>
            <div class="bottom-nav-item" onclick="showMobileMonsterPanel()" data-tab="monsters">
                <span class="nav-icon" id="monstersNavIcon"></span>
                <span class="nav-label">æ€ªå…½</span>
            </div>
            <div class="bottom-nav-item" onclick="switchTab('exploration')" data-tab="exploration">
                <span class="nav-icon" id="explorationNavIcon"></span>
                <span class="nav-label">æ¢ç´¢</span>
            </div>
            <div class="bottom-nav-item" onclick="switchTab('breeding')" data-tab="breeding">
                <span class="nav-icon" id="breedingNavIcon"></span>
                <span class="nav-label">ç¹æ®–</span>
            </div>
            <div class="bottom-nav-item" onclick="switchTab('tech')" data-tab="tech">
                <span class="nav-icon" id="techNavIcon"></span>
                <span class="nav-label">ç§‘æŠ€</span>
            </div>
            <div class="bottom-nav-item" onclick="switchTab('disposal')" data-tab="disposal">
                <span class="nav-icon" id="disposalNavIcon"></span>
                <span class="nav-label">å¤„ç†</span>
            </div>
        </div>
    </div>
    
    <!-- æ¨¡æ€æ¡† -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent"></div>
    </div>

    <!-- æŒ‰é¡ºåºåŠ è½½JSæ¨¡å— -->
    <script src="js/main.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/farm.js"></script>
    <script src="js/monster.js"></script>
    <script src="js/exploration.js"></script>
    <script src="js/breeding.js"></script>
    <script src="js/tech.js"></script>
    <script src="js/disposal.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/resizer.js"></script>
    <script>
        // é¡µé¢åŠ è½½ååˆå§‹åŒ–
        window.addEventListener('load', function() {
            loadGame();   // å°è¯•åŠ è½½å­˜æ¡£
            initGame();   // åˆå§‹åŒ–æ¸¸æˆ
            
            // å¼ºåˆ¶åˆå§‹åŒ–UIç»„ä»¶
            setTimeout(function() {
                updateResources();
                renderAll();
                
                // ç¡®ä¿ä¾§è¾¹æ å›¾æ ‡æ˜¾ç¤º
                updateSidebarResources();
                initMobileNavIcons();
            }, 100);
        });
        
        // DOMContentLoaded å¤‡ç”¨åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded triggered');
            
            // å¼ºåˆ¶æ˜¾ç¤ºåº”ç”¨å®¹å™¨
            var appContainer = document.querySelector('.app-container');
            if (appContainer) {
                appContainer.style.display = 'flex';
                appContainer.style.minHeight = '100vh';
                console.log('App container forced to display');
            }
            
            // å¼ºåˆ¶æ˜¾ç¤ºä¾§è¾¹æ 
            var sidebar = document.getElementById('sidebar');
            if (sidebar) {
                sidebar.style.display = 'flex';
                sidebar.style.flexDirection = 'column';
                console.log('Sidebar forced to display');
            }
            
            // å¼ºåˆ¶æ˜¾ç¤ºä¸»å®¹å™¨
            var mainContainer = document.querySelector('.main-container');
            if (mainContainer) {
                mainContainer.style.display = 'flex';
                mainContainer.style.flexDirection = 'column';
                // æ³¨æ„ï¼šmargin ç”± CSS å˜é‡ --left-width / --right-width æ§åˆ¶ï¼Œå‹¿åœ¨æ­¤ç¡¬å†™
                console.log('Main container forced to display');
            }

            // å¼ºåˆ¶æ˜¾ç¤ºå³ä¾§æ€ªå…½ä¾§è¾¹æ 
            var monsterSidebar = document.getElementById('monsterSidebar');
            if (monsterSidebar) {
                monsterSidebar.style.display = 'flex';
                monsterSidebar.style.flexDirection = 'column';
                console.log('Monster sidebar forced to display');
            }
            
            // å¦‚æœå…ƒç´ å­˜åœ¨ä½†æ²¡æœ‰å†…å®¹ï¼Œå¼ºåˆ¶è®¾ç½®
            setTimeout(function() {
                var coinsIcon = document.getElementById('coinsIcon');
                var foodIcon = document.getElementById('foodIcon');
                var materialsIcon = document.getElementById('materialsIcon');
                var researchIcon = document.getElementById('researchIcon');
                var energyIcon = document.getElementById('energyIcon');
                
                // ç®€å•çš„SVGåˆ›å»ºå‡½æ•°ä½œä¸ºåå¤‡
                function createSimpleSVG(type, size) {
                    var svgMap = {
                        coin: '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#f0c53d"/></svg>',
                        food: '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#46d164"/></svg>',
                        material: '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12" fill="#8b949e"/></svg>',
                        research: '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><polygon points="12,2 22,20 2,20" fill="#58a6ff"/></svg>',
                        energy: '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#2ea043"/></svg>'
                    };
                    return svgMap[type] || '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#666"/></svg>';
                }
                
                if (coinsIcon) {
                    coinsIcon.innerHTML = (typeof createSVG === 'function' ? createSVG('coin', 20) : createSimpleSVG('coin', 20));
                    console.log('Coins icon set');
                }
                if (foodIcon) {
                    foodIcon.innerHTML = (typeof createSVG === 'function' ? createSVG('food', 20) : createSimpleSVG('food', 20));
                    console.log('Food icon set');
                }
                if (materialsIcon) {
                    materialsIcon.innerHTML = (typeof createSVG === 'function' ? createSVG('material', 20) : createSimpleSVG('material', 20));
                    console.log('Materials icon set');
                }
                if (researchIcon) {
                    researchIcon.innerHTML = (typeof createSVG === 'function' ? createSVG('research', 20) : createSimpleSVG('research', 20));
                    console.log('Research icon set');
                }
                if (energyIcon) {
                    energyIcon.innerHTML = (typeof createSVG === 'function' ? createSVG('energy', 20) : createSimpleSVG('energy', 20));
                    console.log('Energy icon set');
                }
                
                // æ£€æŸ¥å¹¶æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
                console.log('Layout fix applied. If you still see issues, check browser console for errors.');
            }, 200);
        });
    </script>
</body>
</html>